apiVersion: v1
kind: Pod
metadata:
  name: "reference-app-nft-test"
  annotations:
    "helm.sh/hook": test
spec:
  initContainers:
    - name: nft-load-testing-hello
      image: {{ .Values.registry }}/{{ .Values.nft.image }}:{{ .Values.tag }}
      env:
        - name: SERVICE_ENDPOINT
          value: "http://reference-service"
      command: [ 'sh' ]
      args: [ "-c", "k6 run ./load-testing/hello.js" ]
  containers:
    - name: nft-load-testing-downstream
      image: {{ .Values.registry }}/{{ .Values.nft.image }}:{{ .Values.tag }}
      resources:
        requests:
          cpu: "700m"
          memory: "256Mi"
        limits:
          memory: "512Mi"
      env:
        - name: SERVICE_ENDPOINT
          value: "http://reference-service"
        - name: WIREMOCK_ENDPOINT
          value: "http://wiremock"
      command: [ 'sh' ]
      args: [ "-c", "k6 run ./load-testing/downstream.js" ]
  restartPolicy: Never